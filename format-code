#!/usr/bin/env python
import os
import sys
from pathlib import Path


def format_file(path):
    print(f"Formatting {path}")
    os.system(f"clang-format -i {path}")


def format_files(root: Path = Path(), extensions=None, exclude_dirs=None) -> None:
    extensions = extensions or []
    exclude_dirs = [Path(root) / d for d in exclude_dirs or []]

    for dirpath, dirnames, filenames in os.walk(root):
        for name in filenames:
            path = Path(dirpath) / name
            if any([name.endswith(ext) for ext in extensions]):
                format_file(path)

        # prune excluded directories
        dirnames[:] = [d for d in dirnames if Path(dirpath) / d not in exclude_dirs]


def main() -> None:
    root = sys.argv[1] if len(sys.argv) > 1 else ""
    extensions = [".h", ".cpp"]
    exclude_dirs = ["build"]

    format_files(root=Path(root), extensions=extensions, exclude_dirs=exclude_dirs)


if __name__ == "__main__":
    main()
